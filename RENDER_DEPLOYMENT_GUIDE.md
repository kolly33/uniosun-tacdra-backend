# 🚀 UNIOSUN TACDRA - Render Deployment Guide

## Overview
This guide provides step-by-step instructions for deploying the UNIOSUN TACDRA backend API to Render following industry best practices.

## 📋 Prerequisites

1. **GitHub Repository**: Your code should be in a GitHub repository
2. **Render Account**: Sign up at [render.com](https://render.com)
3. **Domain Access**: Access to configure your domain (optional)
4. **Payment Gateway**: Remita production credentials

## 🗄️ Database Setup

### Option 1: Render PostgreSQL (Recommended)
1. Go to Render Dashboard
2. Click "New" → "PostgreSQL"
3. Configure:
   - **Name**: `uniosun-tacdra-db`
   - **Database Name**: `uniosun_tacdra`
   - **User**: `tacdra_user`
   - **Region**: `Oregon` (or nearest to your users)
   - **Plan**: `Starter` ($7/month) or `Free` (limited)

### Option 2: External Database (Alternative)
- **PlanetScale**: MySQL-compatible, generous free tier
- **Railway**: PostgreSQL/MySQL options
- **AWS RDS**: Production-grade, more expensive

## 🌐 Web Service Deployment

### Step 1: Connect Repository
1. Go to Render Dashboard
2. Click "New" → "Web Service"
3. Connect your GitHub repository
4. Select the repository containing your code

### Step 2: Configure Build Settings
```bash
# Build Command
chmod +x render-build.sh && ./render-build.sh

# Start Command
npm run start:prod

# Environment
Node.js

# Health Check Path
/health
```

### Step 3: Environment Variables
Set these in Render Dashboard under "Environment":

#### 🔒 Security Variables
```bash
NODE_ENV=production
JWT_SECRET=<auto-generated-by-render>
JWT_EXPIRES_IN=24h
```

#### 🗄️ Database Variables
```bash
DATABASE_HOST=<your-database-host>
DATABASE_PORT=5432
DATABASE_USERNAME=<your-database-user>
DATABASE_PASSWORD=<your-database-password>
DATABASE_NAME=uniosun_tacdra
```

#### 💳 Payment Variables (Remita Production)
```bash
REMITA_MERCHANT_ID=<your-production-merchant-id>
REMITA_SERVICE_TYPE_ID=<your-production-service-type>
REMITA_API_KEY=<your-production-api-key>
REMITA_BASE_URL=https://login.remita.net
```

#### 📁 File Upload Variables
```bash
MAX_FILE_SIZE=10485760
UPLOAD_PATH=./uploads
```

#### 🌍 URL Variables
```bash
FRONTEND_URL=https://uniosuntacdvs.vercel.app
# APP_URL will be auto-set by Render
```

### Step 4: Advanced Settings
```bash
# Region: Oregon (or nearest to your users)
# Plan: Starter ($7/month) or Free (512MB RAM, sleeps after 15min)
# Auto-Deploy: Yes (deploys on git push)
```

## 🔄 Database Migration Strategy

Since you're moving from MySQL to PostgreSQL, you'll need to:

### Option 1: Update to PostgreSQL
1. Install PostgreSQL driver:
```bash
npm install pg @types/pg
npm uninstall mysql2
```

2. Update `app.module.ts`:
```typescript
type: 'postgres', // Changed from 'mysql'
```

### Option 2: Use MySQL on Render
1. Use external MySQL service (PlanetScale, Railway)
2. Keep current MySQL configuration
3. Update connection strings only

## 📊 Monitoring & Logging

### Built-in Render Features
- **Logs**: Real-time logs in Render dashboard
- **Metrics**: CPU, Memory, Response time monitoring
- **Health Checks**: Automatic restart on failures
- **SSL**: Automatic HTTPS certificates

### Health Check Endpoints
- `GET /` - Basic health check
- `GET /health` - Detailed status
- `GET /api/docs` - API documentation

## 🔧 Production Optimizations

### 1. Database Configuration
```typescript
// In app.module.ts
synchronize: false, // Never true in production
logging: ['error'], // Only log errors
maxQueryExecutionTime: 1000, // Log slow queries
```

### 2. Security Headers
Add security middleware for production:
```typescript
// Install helmet
npm install helmet
// Configure in main.ts
app.use(helmet());
```

### 3. Rate Limiting
```typescript
// Install rate limiter
npm install @nestjs/throttler
// Configure in app.module.ts
```

## 🚀 Deployment Steps

### 1. Prepare Repository
```bash
# Ensure all files are committed
git add .
git commit -m "Production deployment setup"
git push origin main
```

### 2. Create Render Services
1. **Database First**: Create PostgreSQL database
2. **Web Service**: Connect repository and configure
3. **Environment Variables**: Set all required variables
4. **Deploy**: Trigger first deployment

### 3. Post-Deployment
1. **Test Health**: Visit `https://your-app.onrender.com/health`
2. **Test API**: Visit `https://your-app.onrender.com/api/docs`
3. **Test Frontend**: Verify frontend can connect
4. **Monitor Logs**: Check for any errors

## 🔍 Troubleshooting

### Common Issues

#### 1. Build Failures
- Check `render-build.sh` permissions
- Verify all dependencies in `package.json`
- Check Node.js version compatibility

#### 2. Database Connection
- Verify connection string format
- Check database is running and accessible
- Test connection from external tool

#### 3. Environment Variables
- Ensure all required variables are set
- Check for typos in variable names
- Verify sensitive values are properly set

#### 4. CORS Issues
- Update CORS origins to include Render URLs
- Check frontend URLs are whitelisted
- Verify credentials setting

### Debugging Commands
```bash
# View logs
curl https://your-app.onrender.com/health

# Test database connection
curl https://your-app.onrender.com/api/docs

# Check environment
curl https://your-app.onrender.com/
```

## 💰 Cost Optimization

### Free Tier Limitations
- **Free Plan**: 512MB RAM, sleeps after 15min inactivity
- **Free Database**: 1GB storage, 90-day expiration
- **Starter Plan**: $7/month, no sleep, 512MB RAM

### Recommended Setup for Production
- **Web Service**: Starter ($7/month)
- **Database**: Starter ($7/month)
- **Total**: $14/month

## 🔐 Security Checklist

- [ ] Strong JWT secret (auto-generated)
- [ ] Database credentials secured
- [ ] HTTPS enabled (automatic on Render)
- [ ] Environment variables properly set
- [ ] File upload limits configured
- [ ] CORS properly configured
- [ ] Rate limiting enabled
- [ ] Input validation active
- [ ] Error logging configured
- [ ] Health checks working

## 📈 Scaling Considerations

### Performance Monitoring
- Monitor response times in Render dashboard
- Watch memory usage patterns
- Track database query performance
- Monitor file upload patterns

### Scaling Options
1. **Vertical Scaling**: Upgrade to higher RAM plans
2. **Database Scaling**: Upgrade database plan
3. **CDN**: Use Cloudflare for static assets
4. **File Storage**: Move to AWS S3 for uploads

## 🎯 Next Steps

1. **Deploy to Render** following this guide
2. **Test thoroughly** with frontend integration
3. **Monitor performance** and logs
4. **Set up monitoring** alerts
5. **Plan for scaling** based on usage

## 📞 Support

- **Render Documentation**: [render.com/docs](https://render.com/docs)
- **NestJS Deployment**: [docs.nestjs.com](https://docs.nestjs.com)
- **API Testing**: Use the Swagger UI at `/api/docs`

## 🔄 Continuous Deployment

Render automatically deploys when you push to your main branch:
```bash
git add .
git commit -m "Feature: Add new functionality"
git push origin main
# Deployment automatically triggered
```

---

**🎉 Your UNIOSUN TACDRA backend will be live and production-ready!**
